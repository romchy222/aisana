<!DOCTYPE html>
<html>
<head>
    <title>Debug Like/Dislike System</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-response { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .feedback-buttons { margin-top: 10px; }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫</h1>
    
    <button onclick="sendTestMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
    
    <div id="responses"></div>

    <script>
        async function sendTestMessage() {
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Ä–∞–±–æ—Ç–µ",
                        language: "ru"
                    })
                });
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    displayResponse(data);
                } else {
                    console.error('Error:', data.error);
                }
            } catch (error) {
                console.error('Fetch error:', error);
            }
        }
        
        function displayResponse(data) {
            const container = document.getElementById('responses');
            const responseDiv = document.createElement('div');
            responseDiv.className = 'test-response';
            
            responseDiv.innerHTML = `
                <strong>–û—Ç–≤–µ—Ç:</strong> ${data.response}<br>
                <strong>–ê–≥–µ–Ω—Ç:</strong> ${data.agent_name}<br>
                <strong>Message ID:</strong> ${data.message_id}<br>
                <strong>Feedback –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:</strong> ${JSON.stringify(data.feedback || {})}<br>
                
                <div class="feedback-buttons">
                    <button onclick="sendFeedback('${data.message_id}', true)">üëç –õ–∞–π–∫</button>
                    <button onclick="sendFeedback('${data.message_id}', false)">üëé –î–∏–∑–ª–∞–π–∫</button>
                </div>
            `;
            
            container.appendChild(responseDiv);
        }
        
        async function sendFeedback(messageId, isLike) {
            try {
                const response = await fetch('/api/feedback/like-dislike', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message_id: messageId,
                        is_like: isLike
                    })
                });
                
                const data = await response.json();
                console.log('Feedback response:', data);
                
                if (data.success) {
                    alert(data.message);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('Feedback error:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ feedback');
            }
        }
    </script>
</body>
</html>